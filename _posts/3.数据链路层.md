# 3.1数据链路层的功能
- 为防止在传输过程中帧丢失，在可靠的数据链路层协议中，发送方对发送的每个数据帧设计一个计时器，当计时器到期而该帧的确认帧仍未到达时，发送方将重发该帧。为保证接收方不会接收到重复帧，需要对每个发送的帧进行编号:海明码和循环冗余检验码都用于差错控制。
- 对于信道比较可靠且对实时性要求高的网络，数据链路层采用无确认的无连接服务比较合适<br>![img1](../_resources/image.png)
- 数据链路层的标准协议有[HDLC,PPP,SLIP](https://www.doubao.com/thread/a3ab0b18fdb08)(ICMP是网络层协议)
# 3.2组帧
- **字符计数法**是指在帧首部使用一个计数字段来记录该帧所含的字节数(包括计数字段自身所占用的1个字节)<br>
**字节填充法**使用特定字节来定界一帧的开始与结束,eg:SOH表示开始,EOT表示结束<br>
**零比特填充法**使用一个特定的比特串 01111110 来标志一帧的开始与结束(每遇到5个连续的“1”，就自动在其后插入一个“0”)<br>
**违规编码法**eg:曼彻斯特编码方法将数据比特“1”编码成“高-低”电平对，将数据比特“0”编码成“低-高”电平对，而“高-高”电平对和“低-低”电平对在数据比特中是违规的(即没有采用)，因此可借用这些违规编码序列来定界帧的开始与结束
# 3.3差错控制
- **奇偶检验码**是奇检验码(数据中1的个数是奇数)和偶检验码(数据中1的个数是偶数)的统称
- **循环冗余码**:双方约定一个多项式eg:$x^{3}+x^{2}+1(1101)$,发送方把数据后边补上三个零(最高次项的次数)除以这个1101,然后把余数附加到数据后边发出去;接收方把收到的数据除以1101,如果没有出错那么刚好除尽<br>循环冗余码(CRC)是具有纠错功能的，只是数据链路层仅使用了它的检错功能
- [**海明码**](https://www.bilibili.com/video/BV1GF411V7sC?vd_source=c6d2d8c637bc4cf341d83587cc4b4b54):以0~15为例<br>
  >0:对整个盘面进行纠错;<br>
    1:对1,3,5,7,...,15进行纠错<br>
    2:对2,3,6,7,10,11,14,15进行纠错<br>
    4:对4,5,6,7,12,13,14,15进行纠错<br>
    8:对8~15进行纠错;<br>
  >海明码很像二分法,8对一半进行纠错,4对一半的一半进行纠错,2对一半的一半的一半进行纠错...
- **海明码码距**,晕,我实在是搞不懂了,死记硬背吧
  >“纠错”d位,需要码距为 2d+1;“检错”d 位,需码距为 d+1。
- 计算增加冗余信息位的位数:$m+n\le2^{n}-1$<br>
  m:数据位的位数;n信息位的位数;
# 3.4流量控制与可靠传输机制
- **ARQ**（Automatic Repeat reQuest，即自动重传请求协议）分为三种：<br>**停止等待协议**（SW,Stop-and-Wait）：发送一个数据帧，接收一个确认帧；<br>**后退N帧（Go-Back-N）**:发送N个数据帧，接受一个确认帧；<br>**选择重传（Selective repeat）**:发送多个数据帧，接受多个数据帧，对每一个数据帧进行确认，此外对于出错的数据帧接收方还会发送NAK否定帧<br>这三分协议都依赖确认和超时重传(发送一个数据帧启动一个计时器，在规定时间内没有收到确认帧就重传)两种机制<br>
  >后两个还要满足两个条件：<br>
  >1.发送窗口$\ge$接受窗口（要不接受窗口永远填不满）<br>2.发送窗口+接受窗口$\le2^{n}$(n:帧编号的比特数)（因为帧编号是重复利用的，如果大于该值就会出现帧编号重复的数据帧）<br>eg:若发送窗口的大小为32，则至少需要6bit序列号协议才不会出错
- <br>![alt text](../_resources/image%20copy.png)<br>发送方发送012345670123，先发送了012345，接收方也接受到了012345，然后发送确认帧5，期待接受670，**但是**这时候网络不好，发送方没有收到确认帧，然后决定超时重传012345，坏处来了，这个0和接收方想要的0不是一个0
- <br>![alt text](../_resources/Snipaste_2024-11-16_10-06-05.png)<br>![alt text](../_resources/Snipaste_2024-11-16_10-10-21.png)<br>Tips：算数据传输速率的时候可以直接把分子列为每帧中的数据长度
# 3.5介质访问控制
- **频分复用**（FDM，Frequency Division Multiplexing）:在一条信道上划分多个频带范围，每个频带之间还要有一定的频带隔离范围，防止互相干扰；<br>
 **时分复用**（TDM，Time Division Multiplexing）：把一条信道的传输时间划分时间片，每个用户的数据帧间隔传输；<br>
  >时分复用分为同步和异步（统计），前者是固定的时间片，后者是动态地划分时间片
  
  **波分复用**（WDM，wave）：就是光的频分复用；<br>
  **[码分复用](https://www.doubao.com/thread/aea6220d302be)**（CDM，Code Division Multiplexing）：不同的信号采用不同的编码，既共享频率又共享时间
  >码分复用时,各个站点的码片序列必须两两正交<br>eg:![](../_resources/Snipaste_2024-11-18_16-34-41.png)<br>$\vec{a}\cdot\vec{b}=0,\vec{a}\cdot\vec{c}=0,\vec{b}\cdot\vec{c}=0$<br>
  通过码分复用恢复出原始信号的实例:<br>![](../_resources/Snipaste_2024-11-18_16-47-14.png)<br>![](../_resources/Snipaste_2024-11-18_16-49-02.png)<br>我不理解为啥通过与原始码片序列做内积运算就可以恢复出结果,死记着算了
- 频分复用适合传输模拟信号，时分复用适合传输数字信号，所以现代网络中时分复用用的更多,[解释](https://www.doubao.com/thread/aafb5e5ce67d8)
- **随机访问介质访问控制协议**(好拗口):<br>
  1. **ALOHA协议**:<br>
   **纯ALOHA协议**:随时就可以发送数据,如果没有收到确认就说明发生了碰撞,等待一段时间后再发送;<br>
   **时隙ALOHA协议**:同步各站点的时间,把时间划分成一段段时隙,规定每个站点只能在时间段开始时才能发送数据<br>(夏威夷大学发明的,全称也不帮助记忆理解,不写全称了)<br>
  2. **CSMA协议**(Carrier Sense Multiple Access，载波监听多路访问):<br>
   **坚持CSMA**:一直监听信道,信道空闲就发送数据;<br>
   **非坚持CSMA**:监听到信道忙就放弃监听,等待一端随机的时间后再监听;<br>
   **p-坚持CSMA**(只适用于TDM信道):一直监听信道,信道空闲等待以概率p发送数据,1-p的概率在下一个时间段发送数据<br>
  3. **CSMA/CD协议**(Carrier Sense Multiple Access with Collision Detection，载波监听多路访问/碰撞检测):先听后发，边听边发，冲突停发，随机重发;<br>CSMA/CD 协议中定义的**争用期**是指信号在最远两个端点之间往返传输的时间。
     >10Mb/s和100Mb/s的以太网中的争用期被定义为64B的发送时间([解释](https://www.doubao.com/thread/ab717a81b1383))
     >>eg:![](../_resources/Snipaste_2024-11-18_16-15-37.png)<br>一个站点到hub是100米,两个站点之间是200米,一来一回400米;
  4. [**CSMA/CA协议**](https://www.doubao.com/thread/a750759450bf3)(Carrier Sense Multiple Access with Collision Avoidance载波监听多路访问/碰撞避免):先监听信道,等到信道空闲的时候设置一个随机退避值(期间如何信道再忙起来就暂停计时),退避时间结束站点发送数据 ,接受方收到数据后发送ACK确认帧,接收方没有收到确认帧的话就按照上述规则再重发一遍;
- **情景假设**:设备A想向设备B发送数据<br>
  >设备A首先向设备B发送RTS(Request To Send)帧表示请求发送数据;<br>
  恰好此时多个设备同时尝试发送数据,然后采用二进制指数退避,设备A在等待了一段时间后(信道忙就计时器暂停),重新发送RTS帧;<br>
  设备B受到了RTS帧后回复CTS(Clear To Send)表示允许发送;<br>
其他设备接收到了RTS帧或者CTS帧后就知道这俩设备要预约信道了(预约信道并不是 CSMA/CA 的强制规定，在普通模式下不进行预约信道。)
>
- **DIFS,PIFS,SIFS帧间间隔的作用场景**:<br>
  在上述情境中,设备A在向设备B发送RTS帧之前等待DIFS段时间,以后传输数据时,每帧之间间隔SISF(short ISF)段时间<br>
  如果是点协调的场景下,AP(Access Point,开热点的手机,家里边的WIFI,5G信号塔都是AP)在PIFS段时间下发送RTS帧;
  >DIFS>PIFS>SIFS;
- **二进制退避算法**:从[0,$2^{k}-1$]里随机选一个数
  >超出10次以外的冲突就不算了,要是算的话,要等到猴年马月去了,也就是说k=min[k,10];
  >>![alt text](../_resources/Snipaste_2024-11-18_09-25-19.png)
- **令牌环网络**:<br>
  >![alt text](../_resources/Snipaste_2024-11-18_09-01-37.png)
  令牌环网络的结点只能在一定时间内(令牌持有时间)发送数据,不能一直持有令牌,并且如果结点没有数据传输时要迅速把令牌传递下去
- **以太网的最小帧长**是指在争用期这一段时间内发送数据的长度,也就是说,最小帧长是数据填满信道一来一回的长度,第一个bit刚刚回来,最后一个bit刚刚发出
- 无线局域网不使用 CSMA/CD 而使用 CSMA/CA 的原因是，无线局域网难以实现冲突检测，存在隐蔽站和暴露站问题<br>
  >![](../_resources/Snipaste_2024-11-18_16-21-50.png)<br>![](../_resources/Snipaste_2024-11-18_16-22-09.png)
# 3.6局域网


